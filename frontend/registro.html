<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <!-- meta viewport asegura que la página sea responsive en móviles -->
  <!-- Docs: https://developer.mozilla.org/en-US/docs/Web/HTML/Viewport_meta_tag -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registro</title>
</head>
<body>
  <h1>Registro</h1>

  <form id="registroForm">
    <!-- Campos del formulario, cada uno con "required" -->
    <!-- Más info: https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input -->
    <input type="text" id="name" placeholder="Name" required />
    <input type="email" id="email" placeholder="Email" required />
    <input type="password" id="password" placeholder="Contraseña" required />
    <button type="submit">Registrarse</button>
  </form>

  <hr>

  <!-- Botón que redirige al usuario al endpoint OAuth2/Google -->
  <!-- Este endpoint lo maneja Spring Security automáticamente -->
  <!-- Docs: https://docs.spring.io/spring-security/reference/servlet/oauth2/login/redirect.html -->
  <button onclick="window.location.href='http://localhost:8083/oauth2/authorization/google'">
    Registrarse con Google
  </button>

  <!-- Equivalente para Apple (si se habilita más adelante) -->
  <button onclick="window.location.href='http://localhost:8083/oauth2/authorization/apple'">
    Registrarse con Apple
  </button>

  <script>
    // Agregamos un listener al submit del formulario
    // Más info: https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener
    document.getElementById("registroForm").addEventListener("submit", async (e) => {
      e.preventDefault(); // Evita que el formulario recargue la página automáticamente

      // Obtenemos los valores del formulario
      const data = {
        name: document.getElementById("name").value,
        email: document.getElementById("email").value,
        password: document.getElementById("password").value
      };

      // Enviamos los datos al backend usando fetch() con POST y JSON
      // Más info: https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch
      const response = await fetch("http://localhost:8083/api/auth/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      // El backend responde con texto simple
      const result = await response.text();
      alert(result);

      // Si contiene "correctamente", redirigimos al usuario
      // success.html sería tu página de éxito
      if (result.includes("correctamente")) {
        window.location.href = "success.html";
      }
    });
  </script>
</body>
</html>